<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=apple-touch-icon-precomposed sizes=57x57 href=https://brianshumate.com/apple-touch-icon-57x57.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=https://brianshumate.com/apple-touch-icon-114x114.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=https://brianshumate.com/apple-touch-icon-72x72.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://brianshumate.com/apple-touch-icon-144x144.png><link rel=apple-touch-icon-precomposed sizes=60x60 href=https://brianshumate.com/apple-touch-icon-60x60.png><link rel=apple-touch-icon-precomposed sizes=120x120 href=https://brianshumate.com/apple-touch-icon-120x120.png><link rel=apple-touch-icon-precomposed sizes=76x76 href=https://brianshumate.com/apple-touch-icon-76x76.png><link rel=apple-touch-icon-precomposed sizes=152x152 href=https://brianshumate.com/apple-touch-icon-152x152.png><link rel=icon type=image/png href=https://brianshumate.com/favicon-196x196.png sizes=196x196><link rel=icon type=image/png href=https://brianshumate.com/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://brianshumate.com/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://brianshumate.com/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://brianshumate.com/favicon-128.png sizes=128x128><meta name=application-name content="Brian Shumate"><meta name=msapplication-TileColor content=#FFFFFF><meta name=msapplication-TileImage content=https://brianshumate.com/mstile-144x144.png><meta name=msapplication-square70x70logo content=https://brianshumate.com/mstile-70x70.png><meta name=msapplication-square150x150logo content=https://brianshumate.com/mstile-150x150.png><meta name=msapplication-wide310x150logo content=https://brianshumate.com/mstile-310x150.png><meta name=msapplication-square310x310logo content=https://brianshumate.com/mstile-310x310.png><meta name=author content="Brian Shumate"><meta name=description content="Personal website and research hub of Brian Shumate"><meta name=keywords content=website,artist,engineer,personal><base href=https://brianshumate.com/articles/command-line-snippets/><title>Command Line Snippets · Brian Shumate</title><link rel=canonical href=https://brianshumate.com/articles/command-line-snippets/><link rel=stylesheet href=https://brianshumate.com/css/brian.min.ca27d672ef95785ec6d614668ceb688d34240be6c33dab1d96b9bc3995a6c394.css integrity="sha256-yifWcu&#43;VeF7G1hRmjOtojTQkC&#43;bDPasdlrm8OZWmw5Q=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://brianshumate.com/fonts/css/ibm-plex.min.css crossorigin=anonymous media=screen></head><body><main class=wrapper><nav class=navigation><section class=container><canvas class=zdg-global-canvas width=26 height=26></canvas>
<a class=navigation-title href=https://brianshumate.com>Brian Shumate</a><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://brianshumate.com/articles/>Articles</a></li><li class=navigation-item><a class=navigation-link href=https://brianshumate.com/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=https://brianshumate.com/contact/>Contact</a></li><li class=navigation-item><a class=navigation-link href=https://brianshumate.com/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Command Line Snippets</h1></div><div class=post-meta><div class=date><span class=posted-on>→&nbsp;
<time datetime=2019-01-04T00:07:26Z>January 4, 2019</time></span>
&nbsp;
•&nbsp;
7 minutes read</span></div></div></header><div><h2 id=the-fine-art-of-snippet-curation>The Fine Art of Snippet Curation</h2><p>Wherein I ramble on a bit about a command line tool that I enjoy using to curate my collection of complex and seldom used but powerful CLI one-liners/snippets, and share some that I&rsquo;ve made for certain command line tools.</p><p>This article is aimed at folks who enjoy using their Unix-like operating system command line, and for those who would also like to learn about a neat tool and system for curating and using a personal collection of command line snippets.</p><p>Most specifically, let us consider the cognitive effort associated with recalling complex or powerful, but often little used command line snippets. For example, it can be extremely handy in certain circumstances to extract the files from a Debian <code>.deb</code> formatted package on a BSD style system, but who can easily recall that it is done with a command like:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ ar vx &lt;package_name.deb&gt;</code></pre></div><p>or how about showing the number of connections in use by PID for a process with <code>strace</code>? That&rsquo;s:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ strace -p <span class=k>$(</span>pidof &lt;process_name&gt;<span class=k>)</span> -f -e <span class=nv>trace</span><span class=o>=</span>network -s <span class=m>10000</span></code></pre></div><p>How do I add an Internet password to the macOS Keychain from the command line again? Oh, yeah:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ security -v add-internet-password <span class=se>\
</span><span class=se></span>  -a &lt;account&gt; <span class=se>\
</span><span class=se></span>  -s &lt;server&gt; <span class=se>\
</span><span class=se></span>  -w &lt;password&gt;</code></pre></div><p>All the handy snippets a regular user of the command line cannot fit in their head need some other place to reside. For many, this place will often be a text file of some sort&emdash; so how about the idea of using a text file of a certain format that brings useful per-snippet attributes and works with a neat CLI tool for managing and searching them?</p><p>Some people are successful with the built-in snippet capabilities of their preferred text editor. Having never really tried my editor&rsquo;s own snippet system, I wanted a more universal tool where the snippets had more usefulness both in and outside of the text editor environment as well.</p><p>To that end, I&rsquo;d previously used a GitHub gist to stash my snippets. Then eventually, a git repository of Markdown documents represented a carefully cataloged snippet collection, but let me tell you&emdash; it was not as easy to search and keep synchronized between systems as it is with the tool I use for this purpose now.</p><h2 id=say-hello-to-pet>Say hello to pet</h2><p>The tool in question is called <a href=https://github.com/knqyf263/pet>pet</a> by <a href=https://github.com/knqyf263>Teppei Fukuda</a>. It is a fantastic and focused MIT-licensed, Go-based CLI tool that interfaces with a listing of CLI snippets that you keep in a TOML formatted text file.</p><p>After using <code>pet</code> for about one year, I&rsquo;ve found it to be a minimalistic, but powerful approach to using snippets.</p><p>Once you have installed the <code>pet</code> binary, it can be used in handy ways, the simplest example being to just list the snippets:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ pet list</code></pre></div><p>The output is essentially the complete raw TOML of your snippet collection:</p><p><a href=https://brianshumate.com/articles/command-line-snippets/pet3.png><figure><img src=https://brianshumate.com/articles/command-line-snippets/pet3.png alt="Screenshot showing pet list output"><figcaption><h4>Example &#39;pet list&#39; output</h4></figcaption></figure></a></p><p>As your personal collection of snippets increases in number, you can use <code>pet search</code> to quickly find them:</p><div class=highlight><pre class=chroma>$ pet search</pre></div><p><a href=https://brianshumate.com/articles/command-line-snippets/pet0.png><figure><img src=https://brianshumate.com/articles/command-line-snippets/pet0.png alt="A screenshot showing an example pet search"><figcaption><h4>An example of pet search</h4></figcaption></figure></a></p><p><code>pet</code> can automatically interface with two popular interactive filtering and selector CLI tools, <a href=https://github.com/junegunn/fzf>fzf</a> and <a href=https://github.com/peco/peco>peco</a> to make navigation and searching of your snippet collection a breeze.</p><p><a href=https://brianshumate.com/articles/command-line-snippets/pet1.png><figure><img src=https://brianshumate.com/articles/command-line-snippets/pet1.png alt="A screenshot showing filtering in pet"><figcaption><h4>Filtering in pet search</h4></figcaption></figure></a></p><p>You can also tag snippets with <code>#</code> and search for tagged snippets by tag.</p><p>You can pass the search result/composed command to a clipboard wrangling tool like <code>pbcopy</code> on macOS:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ pet search <span class=p>|</span> pbcopy</code></pre></div><p>and have the command ready to use with a <code>⌘+v</code>.</p><p>For Linux, you can do the same with <code>xclip</code> or <code>xsel</code>.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ pet search <span class=p>|</span> xclip -selection clipboard</code></pre></div><p>One of the nice things about the snippet format is that you can use dynamic argument placeholders for example values and <code>pet</code> will prompt you for the actual values, which it will then insert into the composed command line.</p><p>In practice, the UI prompting appears as shown in the following screenshot, which contains 3 arguments: a filename, a source string value, and a replacement string value.</p><p><a href=https://brianshumate.com/articles/command-line-snippets/pet2.png><figure><img src=https://brianshumate.com/articles/command-line-snippets/pet2.png alt="A screenshot showing an example of dynamic arguments in pet"><figcaption><h4>An example of dynamic arguments</h4></figcaption></figure></a></p><p>This results in a nicely composed and ready to use command line, like this:</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>$ find ./ -name test-file.txt \
  -exec sed -i &#39;&#39; -e &#39;s/sashimi/nigiri/g&#39; {} \;</code></pre></div><p>The tool is simple and elegant in its usage while doing what it does very well.</p><p>You can use other <code>pet</code> commands to add new entries, like <code>pet new</code> or edit the existing snippets with <code>pet edit</code>, which will invoke the editor you specify in the configuration file.</p><p>You can also use <code>pet sync</code> to synchronize your snippet collection to a GitHub gist or to GitLab so that it can be readily used in multiple environments.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ pet sync
Upload success</code></pre></div><p>Check out the <a href=https://github.com/knqyf263/pet/blob/master/README.md>pet README</a> for full documentation and usage examples!</p><h2 id=hashipets>hashipets</h2><p>As an example of a relatively comprehensive example snippet collection, I created <a href=https://github.com/brianshumate/hashipets>hashipets</a>, which is a curated collection of helpful snippets specifically for HashiCorp command line tools like <a href=https://www.vaultproject.io/>Vault</a>, <a href=https://www.consul.io/>Consul</a>, <a href=https://www.nomadproject.io/>Nomad</a>, <a href=https://packer.io/>Packer</a>, <a href=https://www.vagrantup.com/>Vagrant</a>, and <a href=https://www.terraform.io/>Terraform</a>.</p><p>Based on the accompanying <a href=https://github.com/brianshumate/hashipets/blob/master/README.md>README</a> from the <code>hashipets</code> project, I&rsquo;ll demonstrate here how they might be used with <code>pet</code> and <code>peco</code>. That guidance is specifically for a Mac, but I will show the process for Linux here instead.</p><h3 id=install-pet>Install pet</h3><p>The quickest way to install <code>pet</code> for Linux is to download a binary release from the GitHub project:</p><p>Visit <a href=https://github.com/knqyf263/pet/releases>https://github.com/knqyf263/pet/releases</a> and download the correct <code>.tar.gz</code> for your OS and distribution.</p><p>For example, we&rsquo;ll be using <code>pet_0.3.4_linux_amd64.tar.gz</code>:</p><div class=highlight><pre class=chroma>$ sudo tar -C /usr/local/bin -xzf pet_0.3.4_linux_amd64.tar.gz

$ pet version
pet version 0.3.4</pre></div><p>Yay, now <code>pet</code> is installed and you just need a selector, some configuration, and snippets!</p><h3 id=choose-a-selector-fuzzy-finder>Choose a Selector / Fuzzy Finder</h3><p>Now it&rsquo;s time to pick a fuzzy finder for use by pet; it&rsquo;s necessary for all of the convenience features, like searching. The most common of these tools and automatically supported are <a href=https://github.com/junegunn/fzf>fzf</a> and <a href=https://github.com/peco/peco>peco</a>.</p><p>The <code>hashipets</code> project example uses <code>peco</code>, so this guide will as well. Feel free to try <code>fzf</code> as it is a great search tool as well.</p><h4 id=install-peco>Install peco</h4><p>The quickest way to install <code>peco</code> for Linux is to download a binary release from the GitHub project:</p><p>Visit <a href=https://github.com/peco/peco/releases>https://github.com/peco/peco/releases</a> and download the correct <code>.tar.gz</code> for your OS and distribution.</p><p>In this example, it&rsquo;s <code>peco_linux_amd64.tar.gz</code> under the <strong>0.5.3</strong> release tag.</p><div class=highlight><pre class=chroma>$ tar  -zxf peco_linux_amd64.tar.gz
$ sudo cp peco_linux_amd64/peco /usr/local/bin/

$ peco --version
peco version v0.5.3 (built with go1.10)</pre></div><p>You&rsquo;re now ready to configure <code>pet</code> and <code>peco</code>.</p><h4 id=configure-pet-to-use-hashipets-snippets>Configure pet to use hashipets snippets</h4><p>In this example, we will just clone the <code>hashipets</code> repository to a
temporary directory, then configure <code>pet</code> to use its snippets.</p><div class=highlight><pre class=chroma>$ export HASHIPETS=/tmp/hashipets
$ git clone https://github.com/brianshumate/hashipets.git $HASHIPETS
$ pet configure</pre></div><p>Use the value from <code>$HASHIPETS</code> to create the full path for the <code>snippetfile</code> option value: <code>/tmp/hashipets/hashipets.toml</code>.</p><p>Here&rsquo;s a complete <code>pet</code> configuration example:</p><div class=highlight><pre class=chroma>$ cat ~/.config/pet/config.toml
[General]
  snippetfile = &#34;/tmp/hashipets/hashipets.toml&#34;
  editor = &#34;vim&#34;
  column = 40
  selectcmd = &#34;peco --layout=bottom-up&#34;

[Gist]
  file_name = &#34;my-custom-snippets.toml&#34;
  access_token = &#34;42c0ffee8ddc568ffc0ffeeae8ac0ffeebe2a474&#34;
  gist_id = &#34;c0ffee3b76be396c0ffeede8dc0ffe73&#34;
  public = false</pre></div><p>Here&rsquo;s what&rsquo;s going on in the previous <code>config.toml</code> example:</p><ul><li><strong>General</strong> pet settings<ul><li><code>snippetfile</code>: the path to our snippets</li><li><code>editor</code>: the editor invoked with <code>pet edit</code></li><li><code>column</code>: the target display column width</li><li><code>selectcmd</code>: the command line for the select/search tool</li></ul></li><li><strong>Gist</strong> settings<ul><li><code>file_name</code> the gist filename</li><li><code>access_token</code>: the GitHub personal access token</li><li><code>gist_id</code> the gist ID string</li><li><code>public</code> whether the gist is public or not</li></ul></li></ul><h4 id=configure-peco>Configure peco</h4><p>Go ahead and set up a custom <code>peco</code> configuration if you&rsquo;d like as well;
the one from hashipets is a good fun start:</p><div class=highlight><pre class=chroma>$ mkdir -p ~/.config/peco &amp;&amp;
  tee ~/.config/peco/config.json &lt;&lt;EOF
{
    &#34;Prompt&#34;: &#34;🐶  pet&gt;&#34;,
    &#34;Style&#34;: {
        &#34;Basic&#34;: [&#34;on_default&#34;, &#34;default&#34;],
        &#34;SavedSelection&#34;: [&#34;bold&#34;, &#34;on_yellow&#34;, &#34;white&#34;],
        &#34;Selected&#34;: [&#34;underline&#34;, &#34;on_cyan&#34;, &#34;black&#34;],
        &#34;Query&#34;: [&#34;yellow&#34;, &#34;bold&#34;],
        &#34;Matched&#34;: [&#34;white&#34;, &#34;bold&#34;]
    }
}
EOF</pre></div><p>You can now try a command to get started; go ahead and search the
hashipets snippets:</p><div class=highlight><pre class=chroma>$ pet search</pre></div><p>Provided all went well, you should be browsing the snippet list and be
able to search/filter them:</p><p><a href=https://brianshumate.com/articles/command-line-snippets/pet4.png><figure><img src=https://brianshumate.com/articles/command-line-snippets/pet4.png alt="Screenshot showing browsing of hashipets snippets in pet"><figcaption><h4>Browsing the hashipets snippets!</h4></figcaption></figure></a></p><p>I hope this article and the projects in it have been useful to you.</p><p>Enjoy!</p></div><footer></footer></article></section></div><footer class=footer><hr class=fadehr><section class=container><p id=serendipity></p>© 2019
Brian Shumate · All Rights Reserved</section></footer></main></body><script src=https://brianshumate.com/js/cash.min.js></script><script src=https://brianshumate.com/js/zdog.dist.min.js></script><script src=https://brianshumate.com/js/app.js type=text/javascript async defer></script></html>